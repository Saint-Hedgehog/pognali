"use strict";var calendar={durationWrapper:document.querySelector(".step__input-area--duration"),prevMonthButton:document.querySelector(".calendar__button--prev"),nextMonthButton:document.querySelector(".calendar__button--next"),dateArea:document.querySelector(".calendar__date"),numbersContainer:document.querySelector(".calendar__numbers"),days:document.querySelectorAll(".calendar__link"),checkIn:document.querySelector("#date-check-in"),checkOut:document.querySelector("#date-check-out")},duration={duration:calendar.durationWrapper.querySelector("#duration-1"),minusButton:calendar.durationWrapper.querySelector(".input-area__button--minus"),plusButton:calendar.durationWrapper.querySelector(".input-area__button--plus")},now=new Date,date={iterYear:now.getFullYear(),iterMonth:now.getMonth(),iterDay:now.getDate()},checks={in:new Date(date.iterYear,date.iterMonth,date.iterDay+1),out:new Date(date.iterYear,date.iterMonth,date.iterDay+parseInt(duration.duration.value))},renderCalendar=function(e,a){var t=new Date(e,a),n=t.toLocaleString("ru",{year:"numeric"}),r=t.toLocaleString("ru",{month:"long"});calendar.dateArea.value=r+" "+n,t.setDate(t.getDate()-t.getDay()+1);for(var c=0;c<calendar.days.length;c++){if(1===t.getDate()){var d=t.toLocaleString("ru",{month:"short"}).replace(".","");calendar.days[c].innerHTML="1<span class=calendar__first-day>"+d+"</span>"}else calendar.days[c].textContent=t.getDate();calendar.days[c].classList.remove("calendar__link--disabled"),calendar.days[c].classList.remove("calendar__link--active"),calendar.days[c].classList.remove("calendar__link--check-in"),calendar.days[c].classList.remove("calendar__link--check-out"),t<now&&calendar.days[c].classList.add("calendar__link--disabled"),t>checks.in&&t<checks.out&&calendar.days[c].classList.add("calendar__link--active"),t.toLocaleString("ru")==checks.in.toLocaleString("ru")&&(calendar.days[c].classList.add("calendar__link--active"),calendar.days[c].classList.add("calendar__link--check-in")),t.toLocaleString("ru")==checks.out.toLocaleString("ru")&&(calendar.days[c].classList.add("calendar__link--active"),calendar.days[c].classList.add("calendar__link--check-out")),t.setDate(t.getDate()+1)}},lengthOf=function(){return Math.round(new Date(checks.out-checks.in).getTime()/864e5+1)},dateOf=function(e){var a=parseInt(e.textContent);return window.utils.indexOf(calendar.numbersContainer,e.parentNode.parentNode)<=1&&a>22?0===date.iterMonth?new Date(date.iterYear-1,11,a):new Date(date.iterYear,date.iterMonth-1,a):window.utils.indexOf(calendar.numbersContainer,e.parentNode.parentNode)>=4&&a<15?11===date.iterMonth?new Date(date.iterYear+1,0,a):new Date(date.iterYear,date.iterMonth+1,a):new Date(date.iterYear,date.iterMonth,a)},dayClickHandler=function(e){""===checks.in?(checks.in=dateOf(e),duration.duration.value="1",calendar.checkIn.value=checks.in,renderCalendar(date.iterYear,date.iterMonth)):""!=checks.in&&(""===checks.out?e.classList.contains("calendar__link--check-in")?(checks.in="",duration.duration.value="0",calendar.checkIn.value="none",renderCalendar(date.iterYear,date.iterMonth)):checks.in<dateOf(e)&&(checks.out=dateOf(e),duration.duration.value=lengthOf(),calendar.checkOut.value=checks.out,renderCalendar(date.iterYear,date.iterMonth)):""!=checks.out&&(e.classList.contains("calendar__link--check-out")?(checks.out="",duration.duration.value="1",calendar.checkOut.value="none",renderCalendar(date.iterYear,date.iterMonth)):checks.in<dateOf(e)?(checks.out=dateOf(e),duration.duration.value=lengthOf(),calendar.checkOut.value=checks.out,renderCalendar(date.iterYear,date.iterMonth)):checks.in>dateOf(e)&&(checks.in=dateOf(e),duration.duration.value=lengthOf(),calendar.checkIn.value=checks.in,renderCalendar(date.iterYear,date.iterMonth))))},initCalendar=function(){calendar.checkIn.value=checks.in,calendar.checkOut.value=checks.out,renderCalendar(date.iterYear,date.iterMonth)};calendar.numbersContainer.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.target.classList.contains("calendar__link")&&dayClickHandler(e.target)}),calendar.prevMonthButton.addEventListener("click",function(e){e.preventDefault(),0===date.iterMonth&&(date.iterYear-=1,date.iterMonth=12),date.iterMonth-=1,renderCalendar(date.iterYear,date.iterMonth)}),calendar.nextMonthButton.addEventListener("click",function(e){e.preventDefault(),11===date.iterMonth&&(date.iterYear+=1,date.iterMonth=-1),date.iterMonth+=1,renderCalendar(date.iterYear,date.iterMonth)}),duration.minusButton.addEventListener("click",function(e){e.preventDefault(),duration.duration.value>2?(duration.duration.value=parseInt(duration.duration.value)-1,checks.out.setDate(checks.out.getDate()-1),calendar.checkOut.value=checks.out):2==duration.duration.value?(duration.duration.value=1,checks.out="",calendar.checkOut.value=checks.out):1==duration.duration.value&&(duration.duration.value=0,checks.in="",calendar.checkIn.value=checks.in,duration.minusButton.classList.add("input-area__button--inactive")),renderCalendar(date.iterYear,date.iterMonth)}),duration.plusButton.addEventListener("click",function(e){e.preventDefault(),duration.duration.value>1?(duration.duration.value=parseInt(duration.duration.value)+1,checks.out.setDate(checks.out.getDate()+1),calendar.checkOut.value=checks.out):1==duration.duration.value?(duration.duration.value=2,checks.out=new Date(date.iterYear,date.iterMonth,date.iterDay+parseInt(duration.duration.value)),calendar.checkOut.value=checks.out):0==duration.duration.value&&(duration.duration.value=1,checks.in=new Date(date.iterYear,date.iterMonth,date.iterDay+1),calendar.checkIn.value=checks.in,duration.minusButton.classList.remove("input-area__button--inactive")),renderCalendar(date.iterYear,date.iterMonth)}),duration.duration.addEventListener("change",function(e){e.preventDefault(),duration.duration.value>1?(""===checks.in&&(checks.in=new Date(date.iterYear,date.iterMonth,date.iterDay+1),calendar.checkIn.value=checks.in),checks.out=new Date(date.iterYear,date.iterMonth,date.iterDay+parseInt(duration.duration.value)),checks.out.setDate(checks.out.getDate()+(parseInt(duration.duration.value)-lengthOf())),calendar.checkOut.value=checks.out,duration.minusButton.classList.remove("input-area__button--inactive")):1==duration.duration.value?(""===checks.in&&(checks.in=new Date(date.iterYear,date.iterMonth,date.iterDay+1),calendar.checkIn.value=checks.in),checks.out="",calendar.checkOut.value=checks.out,duration.minusButton.classList.remove("input-area__button--inactive")):0==duration.duration.value&&(checks.in="",checks.out="",calendar.checkIn.value=checks.in,calendar.checkOut.value=checks.out,duration.minusButton.classList.add("input-area__button--inactive")),renderCalendar(date.iterYear,date.iterMonth)}),initCalendar();